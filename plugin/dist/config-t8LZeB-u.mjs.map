{"version":3,"file":"config-t8LZeB-u.mjs","names":[],"sources":["../../src/shared/config.ts"],"sourcesContent":["import { createHash } from 'node:crypto';\nimport { mkdirSync, readFileSync, realpathSync } from 'node:fs';\nimport { homedir } from 'node:os';\nimport { join, resolve } from 'node:path';\n\nimport type { DatabaseConfig } from './types.js';\n\n/**\n * Cached debug-enabled flag.\n * Resolved once per process -- debug mode does not change at runtime.\n */\nlet _debugCached: boolean | null = null;\n\n/**\n * Returns whether debug logging is enabled for this process.\n *\n * Resolution order:\n * 1. `LAMINARK_DEBUG` env var -- `\"1\"` or `\"true\"` enables debug mode\n * 2. `~/.laminark/config.json` -- `{ \"debug\": true }` enables debug mode\n * 3. Default: disabled\n *\n * The result is cached after the first call.\n */\nexport function isDebugEnabled(): boolean {\n  if (_debugCached !== null) {\n    return _debugCached;\n  }\n\n  // Check environment variable first\n  const envVal = process.env.LAMINARK_DEBUG;\n  if (envVal === '1' || envVal === 'true') {\n    _debugCached = true;\n    return true;\n  }\n\n  // Check config.json\n  try {\n    const configPath = join(getConfigDir(), 'config.json');\n    const raw = readFileSync(configPath, 'utf-8');\n    const config = JSON.parse(raw) as Record<string, unknown>;\n    if (config.debug === true) {\n      _debugCached = true;\n      return true;\n    }\n  } catch {\n    // Config file doesn't exist or is invalid -- that's fine\n  }\n\n  _debugCached = false;\n  return false;\n}\n\n/**\n * Default busy timeout in milliseconds.\n * Must be >= 5000ms to prevent SQLITE_BUSY under concurrent load.\n * Source: SQLite docs + better-sqlite3 performance recommendations.\n */\nexport const DEFAULT_BUSY_TIMEOUT = 5000;\n\n/**\n * Returns the Laminark data directory.\n * Default: ~/.claude/plugins/cache/laminark/data/\n * Creates the directory recursively if it does not exist.\n *\n * Supports LAMINARK_DATA_DIR env var override for testing --\n * redirects all data storage to a custom directory without\n * affecting the real plugin data.\n */\nexport function getConfigDir(): string {\n  const dir = process.env.LAMINARK_DATA_DIR || join(homedir(), '.claude', 'plugins', 'cache', 'laminark', 'data');\n  mkdirSync(dir, { recursive: true });\n  return dir;\n}\n\n/**\n * Returns the path to the single Laminark database file.\n * Single database at ~/.claude/plugins/cache/laminark/data/data.db for ALL projects.\n */\nexport function getDbPath(): string {\n  return join(getConfigDir(), 'data.db');\n}\n\n/**\n * Creates a deterministic SHA-256 hash of a project directory path.\n * Uses realpathSync to canonicalize (resolves symlinks) to prevent\n * multiple hashes for the same directory via different paths.\n *\n * @param projectDir - The project directory path to hash\n * @returns First 16 hex characters of the SHA-256 hash\n */\nexport function getProjectHash(projectDir: string): string {\n  const canonical = realpathSync(resolve(projectDir));\n  return createHash('sha256').update(canonical).digest('hex').slice(0, 16);\n}\n\n/**\n * Returns the default database configuration.\n */\nexport function getDatabaseConfig(): DatabaseConfig {\n  return {\n    dbPath: getDbPath(),\n    busyTimeout: DEFAULT_BUSY_TIMEOUT,\n  };\n}\n"],"mappings":";;;;;;;;;;AAWA,IAAI,eAA+B;;;;;;;;;;;AAYnC,SAAgB,iBAA0B;AACxC,KAAI,iBAAiB,KACnB,QAAO;CAIT,MAAM,SAAS,QAAQ,IAAI;AAC3B,KAAI,WAAW,OAAO,WAAW,QAAQ;AACvC,iBAAe;AACf,SAAO;;AAIT,KAAI;EAEF,MAAM,MAAM,aADO,KAAK,cAAc,EAAE,cAAc,EACjB,QAAQ;AAE7C,MADe,KAAK,MAAM,IAAI,CACnB,UAAU,MAAM;AACzB,kBAAe;AACf,UAAO;;SAEH;AAIR,gBAAe;AACf,QAAO;;;;;;;AAQT,MAAa,uBAAuB;;;;;;;;;;AAWpC,SAAgB,eAAuB;CACrC,MAAM,MAAM,QAAQ,IAAI,qBAAqB,KAAK,SAAS,EAAE,WAAW,WAAW,SAAS,YAAY,OAAO;AAC/G,WAAU,KAAK,EAAE,WAAW,MAAM,CAAC;AACnC,QAAO;;;;;;AAOT,SAAgB,YAAoB;AAClC,QAAO,KAAK,cAAc,EAAE,UAAU;;;;;;;;;;AAWxC,SAAgB,eAAe,YAA4B;CACzD,MAAM,YAAY,aAAa,QAAQ,WAAW,CAAC;AACnD,QAAO,WAAW,SAAS,CAAC,OAAO,UAAU,CAAC,OAAO,MAAM,CAAC,MAAM,GAAG,GAAG;;;;;AAM1E,SAAgB,oBAAoC;AAClD,QAAO;EACL,QAAQ,WAAW;EACnB,aAAa;EACd"}