---
phase: 21-graph-visualization
plan: 03
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - ui/app.js
  - ui/index.html
  - ui/styles.css
autonomous: true

must_haves:
  truths:
    - "Clicking a path waypoint opens a detail panel showing the ordered waypoint timeline"
    - "The detail panel shows KISS summary if the path is resolved"
    - "Each waypoint in the timeline shows its type, color, sequence number, and summary"
    - "The detail panel shows linked entities from the path trigger"
  artifacts:
    - path: "ui/app.js"
      provides: "Path detail panel rendering logic"
      contains: "showPathDetails"
    - path: "ui/index.html"
      provides: "Path detail panel HTML structure"
      contains: "path-detail-panel"
    - path: "ui/styles.css"
      provides: "Path detail panel styles"
      contains: "path-detail"
  key_links:
    - from: "ui/app.js"
      to: "/api/paths/:id"
      via: "fetchPathDetail in laminarkApp"
      pattern: "fetchPathDetail"
    - from: "ui/app.js"
      to: "ui/graph.js"
      via: "laminark:show_path_detail custom event"
      pattern: "show_path_detail"
---

<objective>
Build the path detail panel that shows waypoint timeline, KISS summary, and linked entities when a user clicks on a path.

Purpose: This implements UI-06 â€” the detail view that lets users understand the full story of a debug path, from error through resolution. It complements the visual overlay (Plan 02) with structured textual information.

Output: Path detail panel in HTML, rendering logic in app.js, styled in CSS.
</objective>

<execution_context>
@/home/matthew/.claude/get-shit-done/workflows/execute-plan.md
@/home/matthew/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-graph-visualization/21-01-SUMMARY.md
@ui/app.js
@ui/index.html
@ui/styles.css
@src/paths/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add path detail panel HTML and styles</name>
  <files>ui/index.html, ui/styles.css</files>
  <action>
**In ui/index.html**, add a new aside element for the path detail panel. Place it AFTER the existing detail-panel aside (after line 465, before the script tags):

```html
<aside id="path-detail-panel" class="path-detail-panel hidden">
  <div class="panel-header">
    <h3 id="path-detail-title">Debug Path</h3>
    <button id="path-detail-close" aria-label="Close path detail panel">&times;</button>
  </div>
  <div id="path-detail-body" class="path-detail-body">
    <p class="empty-state">Select a debug path to view details</p>
  </div>
</aside>
```

**In ui/styles.css**, add path detail panel styles:

```css
/* ====================================================================
   Path Detail Panel
   ==================================================================== */

.path-detail-panel {
  position: fixed;
  top: var(--nav-height);
  right: 0;
  width: var(--panel-width);
  height: calc(100vh - var(--nav-height));
  background: var(--surface);
  border-left: 1px solid var(--border);
  z-index: 20;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: transform var(--transition);
}

.path-detail-panel.hidden {
  display: none;
}

.path-detail-body {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
}

/* Path status badge */
.path-status-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.path-status-badge.active {
  background: rgba(210, 153, 34, 0.2);
  color: var(--warning);
}

.path-status-badge.resolved {
  background: rgba(63, 185, 80, 0.2);
  color: var(--success);
}

.path-status-badge.abandoned {
  background: rgba(139, 148, 158, 0.2);
  color: var(--text-muted);
}

/* Path info section */
.path-info-section {
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
}

.path-info-label {
  font-size: 11px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
}

.path-info-value {
  color: var(--text);
  font-size: 13px;
  line-height: 1.4;
}

/* KISS Summary section */
.kiss-summary-section {
  margin-bottom: 16px;
  padding: 10px;
  background: rgba(63, 185, 80, 0.08);
  border: 1px solid rgba(63, 185, 80, 0.2);
  border-radius: var(--radius);
}

.kiss-summary-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--success);
  margin-bottom: 6px;
}

.kiss-summary-field {
  margin-bottom: 6px;
}

.kiss-summary-field-label {
  font-size: 11px;
  color: var(--text-muted);
  font-weight: 600;
}

.kiss-summary-field-value {
  font-size: 12px;
  color: var(--text);
  line-height: 1.4;
}

/* Waypoint timeline */
.waypoint-timeline {
  position: relative;
  padding-left: 20px;
}

.waypoint-timeline::before {
  content: '';
  position: absolute;
  left: 7px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: var(--border);
}

.waypoint-item {
  position: relative;
  padding: 8px 0 8px 12px;
  margin-bottom: 4px;
}

.waypoint-item::before {
  content: '';
  position: absolute;
  left: -17px;
  top: 14px;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 2px solid var(--bg);
}

.waypoint-item[data-type="error"]::before { background: #f85149; }
.waypoint-item[data-type="attempt"]::before { background: #d29922; }
.waypoint-item[data-type="failure"]::before { background: #f0883e; }
.waypoint-item[data-type="success"]::before { background: #3fb950; }
.waypoint-item[data-type="pivot"]::before { background: #a371f7; }
.waypoint-item[data-type="revert"]::before { background: #79c0ff; }
.waypoint-item[data-type="discovery"]::before { background: #58a6ff; }
.waypoint-item[data-type="resolution"]::before { background: #3fb950; }

.waypoint-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 2px;
}

.waypoint-seq {
  font-size: 10px;
  color: var(--text-muted);
  font-weight: 600;
  min-width: 16px;
}

.waypoint-type-label {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.waypoint-time {
  font-size: 10px;
  color: var(--text-muted);
  margin-left: auto;
}

.waypoint-summary {
  font-size: 12px;
  color: var(--text);
  line-height: 1.4;
  word-break: break-word;
}

/* Waypoint timeline section title */
.waypoint-section-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 8px;
  padding-bottom: 4px;
  border-bottom: 1px solid var(--border);
}
```
  </action>
  <verify>Grep for 'path-detail-panel' in ui/index.html. Grep for 'waypoint-timeline' in ui/styles.css. Verify the HTML aside element is properly structured with header, body, and close button.</verify>
  <done>Path detail panel HTML structure and full CSS styles in place, including waypoint timeline with colored dots, KISS summary section, and status badges.</done>
</task>

<task type="auto">
  <name>Task 2: Add path detail rendering logic to app.js</name>
  <files>ui/app.js</files>
  <action>
Add path detail panel rendering to ui/app.js. This handles the `laminark:show_path_detail` custom event (dispatched when clicking waypoint markers in Plan 02) and renders the detail panel content.

**Add showPathDetails() function** (place it after the existing showNodeDetails function, around line 686):

```javascript
function showPathDetails(pathData) {
  var panel = document.getElementById('path-detail-panel');
  var title = document.getElementById('path-detail-title');
  var body = document.getElementById('path-detail-body');

  if (!panel || !title || !body) return;

  var path = pathData.path;
  var waypoints = pathData.waypoints || [];

  title.textContent = 'Debug Path';
  body.innerHTML = '';

  // Status + trigger section
  var infoSection = document.createElement('div');
  infoSection.className = 'path-info-section';

  var statusBadge = document.createElement('span');
  statusBadge.className = 'path-status-badge ' + path.status;
  statusBadge.textContent = path.status;
  infoSection.appendChild(statusBadge);

  var triggerLabel = document.createElement('div');
  triggerLabel.className = 'path-info-label';
  triggerLabel.style.marginTop = '8px';
  triggerLabel.textContent = 'Trigger';
  infoSection.appendChild(triggerLabel);

  var triggerValue = document.createElement('div');
  triggerValue.className = 'path-info-value';
  triggerValue.textContent = path.trigger_summary || 'Unknown trigger';
  infoSection.appendChild(triggerValue);

  // Started at
  var startedLabel = document.createElement('div');
  startedLabel.className = 'path-info-label';
  startedLabel.style.marginTop = '6px';
  startedLabel.textContent = 'Started';
  infoSection.appendChild(startedLabel);

  var startedValue = document.createElement('div');
  startedValue.className = 'path-info-value';
  startedValue.textContent = formatTime(path.started_at);
  infoSection.appendChild(startedValue);

  // Resolved at (if resolved)
  if (path.resolved_at) {
    var resolvedLabel = document.createElement('div');
    resolvedLabel.className = 'path-info-label';
    resolvedLabel.style.marginTop = '6px';
    resolvedLabel.textContent = 'Resolved';
    infoSection.appendChild(resolvedLabel);

    var resolvedValue = document.createElement('div');
    resolvedValue.className = 'path-info-value';
    resolvedValue.textContent = formatTime(path.resolved_at);
    infoSection.appendChild(resolvedValue);
  }

  // Resolution summary
  if (path.resolution_summary) {
    var resLabel = document.createElement('div');
    resLabel.className = 'path-info-label';
    resLabel.style.marginTop = '6px';
    resLabel.textContent = 'Resolution';
    infoSection.appendChild(resLabel);

    var resValue = document.createElement('div');
    resValue.className = 'path-info-value';
    resValue.textContent = path.resolution_summary;
    infoSection.appendChild(resValue);
  }

  body.appendChild(infoSection);

  // KISS Summary (if present)
  if (path.kiss_summary) {
    var kiss;
    try {
      kiss = typeof path.kiss_summary === 'string' ? JSON.parse(path.kiss_summary) : path.kiss_summary;
    } catch (e) { kiss = null; }

    if (kiss) {
      var kissSection = document.createElement('div');
      kissSection.className = 'kiss-summary-section';

      var kissTitle = document.createElement('div');
      kissTitle.className = 'kiss-summary-title';
      kissTitle.textContent = 'KISS Summary';
      kissSection.appendChild(kissTitle);

      var kissFields = [
        { label: 'Problem', value: kiss.problem },
        { label: 'Cause', value: kiss.cause },
        { label: 'Fix', value: kiss.fix },
        { label: 'Prevention', value: kiss.prevention },
      ];

      kissFields.forEach(function(field) {
        if (!field.value) return;
        var fieldDiv = document.createElement('div');
        fieldDiv.className = 'kiss-summary-field';

        var fieldLabel = document.createElement('div');
        fieldLabel.className = 'kiss-summary-field-label';
        fieldLabel.textContent = field.label;
        fieldDiv.appendChild(fieldLabel);

        var fieldValue = document.createElement('div');
        fieldValue.className = 'kiss-summary-field-value';
        fieldValue.textContent = field.value;
        fieldDiv.appendChild(fieldValue);

        kissSection.appendChild(fieldDiv);
      });

      body.appendChild(kissSection);
    }
  }

  // Waypoint timeline
  if (waypoints.length > 0) {
    var wpSectionTitle = document.createElement('div');
    wpSectionTitle.className = 'waypoint-section-title';
    wpSectionTitle.textContent = 'Waypoints (' + waypoints.length + ')';
    body.appendChild(wpSectionTitle);

    var timeline = document.createElement('div');
    timeline.className = 'waypoint-timeline';

    waypoints.forEach(function(wp) {
      var item = document.createElement('div');
      item.className = 'waypoint-item';
      item.setAttribute('data-type', wp.waypoint_type);

      var header = document.createElement('div');
      header.className = 'waypoint-header';

      var seq = document.createElement('span');
      seq.className = 'waypoint-seq';
      seq.textContent = '#' + wp.sequence_order;
      header.appendChild(seq);

      var typeLabel = document.createElement('span');
      typeLabel.className = 'waypoint-type-label';
      var WAYPOINT_COLORS = {
        error: '#f85149', attempt: '#d29922', failure: '#f0883e',
        success: '#3fb950', pivot: '#a371f7', revert: '#79c0ff',
        discovery: '#58a6ff', resolution: '#3fb950'
      };
      typeLabel.style.color = WAYPOINT_COLORS[wp.waypoint_type] || '#8b949e';
      typeLabel.textContent = wp.waypoint_type;
      header.appendChild(typeLabel);

      var time = document.createElement('span');
      time.className = 'waypoint-time';
      time.textContent = formatTime(wp.created_at);
      header.appendChild(time);

      item.appendChild(header);

      if (wp.summary) {
        var summary = document.createElement('div');
        summary.className = 'waypoint-summary';
        summary.textContent = wp.summary;
        item.appendChild(summary);
      }

      timeline.appendChild(item);
    });

    body.appendChild(timeline);
  } else {
    var emptyMsg = document.createElement('p');
    emptyMsg.className = 'empty-state';
    emptyMsg.textContent = 'No waypoints recorded yet.';
    body.appendChild(emptyMsg);
  }

  // Hide the node detail panel if it's open (avoid two panels)
  var nodePanel = document.getElementById('detail-panel');
  if (nodePanel) nodePanel.classList.add('hidden');

  panel.classList.remove('hidden');
}
```

**Add initPathDetailPanel() function:**
```javascript
function initPathDetailPanel() {
  var closeBtn = document.getElementById('path-detail-close');
  if (closeBtn) {
    closeBtn.addEventListener('click', function() {
      var panel = document.getElementById('path-detail-panel');
      if (panel) panel.classList.add('hidden');
    });
  }

  // Listen for path detail events from graph overlay clicks
  document.addEventListener('laminark:show_path_detail', function(e) {
    if (e.detail) {
      showPathDetails(e.detail);
    }
  });
}
```

**Call initPathDetailPanel()** in the DOMContentLoaded handler, after initDetailPanel() (around line 1177):
```javascript
initPathDetailPanel();
```

**Export showPathDetails** on window.laminarkApp:
Add `showPathDetails: showPathDetails` to the laminarkApp exports object.
  </action>
  <verify>Grep for 'showPathDetails' in ui/app.js. Grep for 'initPathDetailPanel' in ui/app.js. Grep for 'kiss-summary' in ui/app.js to verify KISS rendering exists. Grep for 'waypoint-timeline' in ui/app.js to verify timeline rendering.</verify>
  <done>Path detail panel renders waypoint timeline with colored type indicators, KISS summary for resolved paths, trigger/resolution info, and timestamps. Panel opens on waypoint click and closes via X button.</done>
</task>

</tasks>

<verification>
1. Click a waypoint marker on the path overlay and verify the path detail panel opens on the right
2. Verify the panel shows: status badge, trigger summary, started/resolved times
3. Verify waypoints render as a vertical timeline with colored dots matching waypoint type
4. Verify each waypoint shows sequence number, type label, timestamp, and summary
5. For resolved paths with KISS summaries: verify Problem, Cause, Fix, Prevention fields display
6. Verify the close button hides the panel
7. Verify opening a path detail panel hides any open node detail panel
</verification>

<success_criteria>
- Path detail panel opens when clicking waypoint markers
- Waypoint timeline renders with correct color coding per type
- KISS summary section appears for resolved paths with kiss_summary data
- Status badge correctly shows active/resolved/abandoned with appropriate colors
- Close button and panel management work correctly
- No JavaScript errors in console during interaction
</success_criteria>

<output>
After completion, create `.planning/phases/21-graph-visualization/21-03-SUMMARY.md`
</output>
